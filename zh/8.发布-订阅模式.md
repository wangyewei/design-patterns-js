# 发布-订阅模式

​	发布订阅定义对象间的一种**一对多**的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都将得到通知。在`JavaScript`中，一般用事件模型来替代传统的发布-订阅模式。

## 1. 现实中的发布-订阅模式

> 作者最近去面试，面试完后被告知面试通过还需要等待offer审批等相关流程，审批好后可以收到offer，但是到底是什么时候，目前没人知道。
>
> 于是我记下了HR的联系方式，以后的每一天我都会打电话过去询问是否审批通过。除了我。还会有其他应聘者也会每天和HR打电话。
>
> 当然，现实生活中不会有这么笨的求职者和HR，实际上是我把联系方式留在了HR处。HR答应我有结果了立刻反馈，其他应聘者也是一样的，当结果出来后，HR会翻开花名册，遍历上面的电话号码，依次短信告知。

## 2. 发布-订阅模式的作用

​	在上节的例子中，发送短信就是一个发布-订阅模式，我与其他影评这都是订阅者，我们订阅了offer审批的消息。HR作为发布者，会在合适的时候遍历我们的联系方式，依次发布消息。

​	可以发现，在这个例子中使用发布-订阅模式有着显而易见的有点。

- 应聘者不用再天天打电话咨询消息，在合适的时间点，HR作为发布者会通知这些消息给订阅者。
- 应聘者和HR之间不再强耦合在一起，互相不用关心对方，只需要记得发消息就行了。

​	第一点可以说明`发布-订阅模式`可以广泛用于异步编程中，这是一种替代传递回调函数的方案。比如，可以订阅异步请求的`then`或者`fetch`。或者如果想在动画的每一帧完成之后做一些事情，那么可以先订阅一个事件，然后在动画的每一帧完成之后发布这个事件。在异步编程中使用`发布-订阅模式`，就无需过多关注对象在异步运行期间的内部装填，二只需要订阅感兴趣的事件发生点。

​	第二点说明`发布-订阅模式`可以取代对象之间硬编码的通知机制，一个对象不用显式地调用另一个对象地某个接口。`发布-订阅模式`让两个对象松耦合地联系在一起，虽然不太知道彼此地细节，但不影响互相之间的通信。当有新的订阅者出现时，发布者的代码不需要任何修改；同样发布者需要改变时，也不会影响到之前的订阅者。只要之前约定的事件名没有变化，就可以自由地改变它们。

## 3. DOM事件

​	实际上